<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <!-- ç§»åŠ¨ç«¯ä¼˜åŒ– -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="format-detection" content="telephone=no">
  <meta name="mobile-web-app-capable" content="yes">
  <title>å…šå»ºçŸ¥è¯†ç­”é¢˜ç»ƒä¹ ç³»ç»Ÿ</title>
  <style>
    /* åŸºç¡€æ ·å¼ */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Microsoft YaHei", "PingFang SC", "Helvetica Neue", sans-serif;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      background-color: #f5f5f5;
      color: #333;
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 15px;
      min-height: 100vh;
    }

    header {
      background: linear-gradient(135deg, #d32f2f, #b71c1c);
      color: white;
      padding: 20px 0;
      text-align: center;
      border-radius: 10px 10px 0 0;
      margin-bottom: 20px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
      position: relative;
      overflow: hidden;
    }

    header::before {
      content: "";
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
      background-size: 20px 20px;
      opacity: 0.3;
    }

    h1 {
      font-size: 26px;
      margin-bottom: 8px;
      font-weight: 600;
      position: relative;
      z-index: 1;
    }

    .subtitle {
      font-size: 14px;
      opacity: 0.9;
      position: relative;
      z-index: 1;
    }

    .nav-tabs {
      display: flex;
      background-color: #fff;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .tab {
      flex: 1;
      padding: 16px;
      text-align: center;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: all 0.3s ease;
      font-weight: 500;
      font-size: 15px;
      user-select: none;
    }

    .tab.active {
      border-bottom: 3px solid #d32f2f;
      background-color: #f9f9f9;
      font-weight: 600;
      color: #d32f2f;
    }

    .tab-content {
      display: none;
      background-color: #fff;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      margin-bottom: 20px;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .tab-content.active {
      display: block;
    }

    .question-container {
      margin-bottom: 25px;
    }

    .question-type {
      display: inline-block;
      background: linear-gradient(135deg, #d32f2f, #ff5722);
      color: white;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 13px;
      margin-bottom: 15px;
      font-weight: 500;
      box-shadow: 0 2px 4px rgba(211, 47, 47, 0.2);
    }

    .question-text {
      font-size: 18px;
      margin-bottom: 20px;
      font-weight: 500;
      line-height: 1.5;
    }

    .options-container {
      margin: 20px 0;
    }

    .option {
      display: flex;
      align-items: flex-start;
      margin-bottom: 12px;
      padding: 15px;
      border-radius: 8px;
      background-color: #f9f9f9;
      transition: all 0.2s ease;
      cursor: pointer;
      position: relative;
      border: 2px solid transparent;
    }

    .option:hover {
      background-color: #f0f0f0;
      transform: translateY(-2px);
    }

    .option.selected {
      background-color: #e3f2fd;
      border-color: #2196f3;
      box-shadow: 0 2px 6px rgba(33, 150, 243, 0.2);
    }

    .option input {
      margin-right: 12px;
      margin-top: 3px;
      position: absolute;
      opacity: 0;
      width: 100%;
      height: 100%;
      left: 0;
      top: 0;
      cursor: pointer;
      z-index: 1;
    }

    .option-label {
      font-weight: 600;
      margin-right: 10px;
      z-index: 0;
      position: relative;
      color: #d32f2f;
      min-width: 20px;
    }

    .btn {
      display: inline-block;
      padding: 12px 24px;
      background: linear-gradient(135deg, #d32f2f, #ff5722);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      transition: all 0.3s ease;
      margin-right: 10px;
      box-shadow: 0 4px 6px rgba(211, 47, 47, 0.2);
      text-align: center;
      user-select: none;
    }

    .btn:hover {
      background: linear-gradient(135deg, #b71c1c, #e64a19);
      transform: translateY(-2px);
      box-shadow: 0 6px 8px rgba(211, 47, 47, 0.3);
    }

    .btn:active {
      transform: translateY(0);
      box-shadow: 0 2px 4px rgba(211, 47, 47, 0.2);
    }

    .btn-secondary {
      background: linear-gradient(135deg, #757575, #616161);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .btn-secondary:hover {
      background: linear-gradient(135deg, #616161, #424242);
      box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
    }

    .btn-success {
      background: linear-gradient(135deg, #4caf50, #388e3c);
      box-shadow: 0 4px 6px rgba(76, 175, 80, 0.2);
    }

    .btn-success:hover {
      background: linear-gradient(135deg, #388e3c, #2e7d32);
      box-shadow: 0 6px 8px rgba(76, 175, 80, 0.3);
    }

    .result-container {
      margin-top: 25px;
      padding: 20px;
      border-radius: 8px;
      display: none;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .correct {
      background-color: #e8f5e9;
      border-left: 4px solid #4caf50;
    }

    .wrong {
      background-color: #ffebee;
      border-left: 4px solid #f44336;
    }

    .result-title {
      font-weight: 700;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      font-size: 18px;
    }

    .result-title i {
      margin-right: 10px;
      font-size: 22px;
      width: 30px;
      height: 30px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      background-color: white;
    }

    .correct .result-title i {
      color: #4caf50;
    }

    .wrong .result-title i {
      color: #f44336;
    }

    .progress-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 25px;
      padding: 15px;
      background: linear-gradient(135deg, #f9f9f9, #f0f0f0);
      border-radius: 10px;
      border: 1px solid #e0e0e0;
    }

    .progress-text {
      font-weight: 500;
      font-size: 15px;
    }

    .wrong-questions-list {
      margin-top: 20px;
    }

    .wrong-question-item {
      background-color: #fff;
      padding: 20px;
      margin-bottom: 15px;
      border-radius: 8px;
      border-left: 4px solid #ff9800;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      transition: all 0.3s ease;
    }

    .wrong-question-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .filter-container {
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
    }

    .filter-select {
      padding: 10px 15px;
      border-radius: 8px;
      border: 2px solid #e0e0e0;
      background-color: white;
      font-size: 14px;
      font-weight: 500;
      color: #333;
      transition: all 0.3s ease;
      min-width: 150px;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%23333' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
      padding-right: 35px;
    }

    .filter-select:focus {
      border-color: #d32f2f;
      outline: none;
      box-shadow: 0 0 0 3px rgba(211, 47, 47, 0.1);
    }

    .clear-wrong-btn {
      padding: 10px 15px;
      background-color: #ff9800;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .clear-wrong-btn:hover {
      background-color: #f57c00;
    }

    .no-wrong-questions {
      text-align: center;
      padding: 50px 20px;
      color: #757575;
      font-style: italic;
      background-color: #f9f9f9;
      border-radius: 8px;
      border: 2px dashed #e0e0e0;
    }

    .stats-container {
      display: flex;
      justify-content: space-around;
      margin: 25px 0;
      text-align: center;
      gap: 15px;
    }

    .stat-item {
      flex: 1;
      padding: 20px;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      transition: all 0.3s ease;
    }

    .stat-item:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .stat-value {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 5px;
      font-family: 'Arial', sans-serif;
    }

    .stat-label {
      font-size: 14px;
      color: #757575;
      font-weight: 500;
    }

    .total .stat-value {
      color: #2196f3;
    }

    .correct .stat-value {
      color: #4caf50;
    }

    .wrong-stat .stat-value {
      color: #f44336;
    }

    .percentage {
      font-size: 16px;
      margin-top: 8px;
      font-weight: 600;
    }

    .loading {
      text-align: center;
      padding: 60px 20px;
      color: #757575;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .loading::after {
      content: "";
      width: 40px;
      height: 40px;
      margin-top: 20px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #d32f2f;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    .error {
      text-align: center;
      padding: 40px;
      color: #f44336;
      background-color: #ffebee;
      border-radius: 8px;
      border: 1px solid #ffcdd2;
    }

    .success-message {
      text-align: center;
      padding: 15px;
      background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
      color: #2e7d32;
      border-radius: 8px;
      margin-bottom: 20px;
      display: none;
      animation: slideIn 0.3s ease;
      border: 1px solid #a5d6a7;
    }

    .multi-select-hint {
      font-size: 14px;
      color: #ff9800;
      margin-bottom: 15px;
      font-weight: 500;
      padding: 8px 12px;
      background-color: #fff3e0;
      border-radius: 6px;
      border-left: 3px solid #ff9800;
    }

    /* æ¨¡æ‹Ÿè€ƒè¯•æ ·å¼ */
    .exam-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding: 15px;
      background: linear-gradient(135deg, #e3f2fd, #bbdefb);
      border-radius: 10px;
      border-left: 5px solid #2196f3;
    }

    .exam-timer {
      font-size: 18px;
      font-weight: 700;
      color: #1976d2;
      display: flex;
      align-items: center;
    }

    .exam-timer i {
      margin-right: 8px;
      font-size: 20px;
    }

    .exam-progress {
      font-size: 16px;
      font-weight: 600;
      color: #333;
    }

    .exam-actions {
      display: flex;
      justify-content: space-between;
      margin-top: 25px;
      padding-top: 20px;
      border-top: 1px solid #e0e0e0;
    }

    .exam-result-container {
      text-align: center;
      padding: 30px;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      margin: 20px 0;
    }

    .exam-score {
      font-size: 48px;
      font-weight: 800;
      color: #d32f2f;
      margin: 20px 0;
    }

    .exam-stats {
      display: flex;
      justify-content: space-around;
      margin: 30px 0;
    }

    .exam-stat-item {
      text-align: center;
    }

    .exam-stat-value {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 5px;
    }

    .exam-stat-label {
      font-size: 14px;
      color: #757575;
    }

    .exam-review-btn {
      margin-top: 20px;
    }

    .exam-history {
      margin-top: 30px;
    }

    .exam-history-item {
      background-color: white;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      border-left: 4px solid #2196f3;
    }

    .exam-history-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .exam-history-score {
      font-size: 20px;
      font-weight: 700;
      color: #d32f2f;
    }

    .exam-history-date {
      color: #757575;
      font-size: 14px;
    }

    .exam-history-stats {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      color: #555;
    }

    /* ç§»åŠ¨ç«¯ä¼˜åŒ–æ ·å¼ */
    @media (max-width: 768px) {
      .container {
        padding: 10px;
      }

      header {
        padding: 15px 0;
        margin-bottom: 15px;
        border-radius: 8px 8px 0 0;
      }

      h1 {
        font-size: 20px;
        margin-bottom: 5px;
      }

      .subtitle {
        font-size: 12px;
      }

      .nav-tabs {
        flex-direction: column;
        border-radius: 8px;
        overflow: hidden;
      }

      .tab {
        padding: 14px;
        font-size: 15px;
        border-bottom: 1px solid #eee;
        border-right: none;
      }

      .tab.active {
        border-bottom: 3px solid #d32f2f;
      }

      .tab-content {
        padding: 20px 15px;
        border-radius: 8px;
      }

      .question-text {
        font-size: 17px;
        line-height: 1.5;
      }

      .option {
        padding: 14px 12px;
        margin-bottom: 10px;
      }

      .btn {
        padding: 14px 20px;
        font-size: 16px;
        margin: 8px 0;
        width: 100%;
        display: block;
      }

      .progress-container {
        flex-direction: column;
        align-items: stretch;
        padding: 15px;
        gap: 15px;
      }

      .progress-container>div {
        display: flex;
        flex-direction: column;
        width: 100%;
      }

      .stats-container {
        flex-direction: column;
        gap: 10px;
      }

      .stat-item {
        padding: 15px;
      }

      .stat-value {
        font-size: 28px;
      }

      .filter-container {
        flex-direction: column;
        align-items: stretch;
      }

      .filter-select {
        width: 100%;
        margin-bottom: 10px;
      }

      .clear-wrong-btn {
        width: 100%;
        padding: 12px;
      }

      .wrong-question-item {
        padding: 15px;
      }

      .exam-info {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }

      .exam-stats {
        flex-direction: column;
        gap: 15px;
      }

      .exam-history-header {
        flex-direction: column;
        gap: 5px;
      }

      .exam-history-stats {
        flex-direction: column;
        gap: 5px;
      }

      .exam-actions {
        flex-direction: column;
        gap: 10px;
      }
    }

    @media (max-width: 480px) {
      h1 {
        font-size: 18px;
      }

      .question-text {
        font-size: 16px;
      }

      .option-label {
        min-width: 18px;
      }

      .stat-value {
        font-size: 24px;
      }

      .result-title {
        font-size: 16px;
      }

      .btn {
        padding: 12px;
        font-size: 15px;
      }

      .question-type {
        font-size: 12px;
        padding: 4px 10px;
      }

      .exam-score {
        font-size: 36px;
      }

      .exam-stat-value {
        font-size: 22px;
      }
    }

    /* å¤œé—´æ¨¡å¼æ”¯æŒ */
    @media (prefers-color-scheme: dark) {
      body {
        background-color: #121212;
        color: #e0e0e0;
      }

      .tab-content,
      .stat-item,
      .wrong-question-item,
      .exam-history-item,
      .exam-result-container {
        background-color: #1e1e1e;
        color: #e0e0e0;
      }

      .option {
        background-color: #2d2d2d;
      }

      .progress-container {
        background-color: #2d2d2d;
        border-color: #3d3d3d;
      }

      .nav-tabs {
        background-color: #1e1e1e;
      }

      .tab {
        color: #e0e0e0;
      }

      .filter-select {
        background-color: #2d2d2d;
        border-color: #3d3d3d;
        color: #e0e0e0;
      }

      .no-wrong-questions {
        background-color: #2d2d2d;
        border-color: #3d3d3d;
      }

      .exam-info {
        background: linear-gradient(135deg, #2d2d2d, #3d3d3d);
      }
    }

    /* ç¦ç”¨iOSè¡¨å•æ ·å¼ */
    input,
    select,
    textarea {
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      border-radius: 0;
    }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <h1>å…šå»ºçŸ¥è¯†ç­”é¢˜ç»ƒä¹ ç³»ç»Ÿ</h1>
      <div class="subtitle">å·©å›ºç†è®ºçŸ¥è¯† Â· æå‡æ”¿æ²»ç´ å…» Â· è®°å½•å­¦ä¹ è½¨è¿¹</div>
    </header>

    <div class="success-message" id="successMessage" style="display: none;">
      <strong>âœ“ é¢˜ç›®æ•°æ®åŠ è½½æˆåŠŸï¼</strong> ç°åœ¨å¯ä»¥å¼€å§‹ç­”é¢˜äº†ã€‚
    </div>

    <div class="nav-tabs">
      <div class="tab active" data-tab="practice">ç­”é¢˜ç»ƒä¹ </div>
      <div class="tab" data-tab="exam">æ¨¡æ‹Ÿè€ƒè¯•</div>
      <div class="tab" data-tab="wrong">é”™é¢˜æœ¬</div>
      <div class="tab" data-tab="stats">å­¦ä¹ ç»Ÿè®¡</div>
    </div>

    <!-- ç­”é¢˜ç»ƒä¹ é¡µé¢ -->
    <div class="tab-content active" id="practice">
      <div class="question-container">
        <div class="loading" id="loadingMessage">æ­£åœ¨åŠ è½½é¢˜ç›®æ•°æ®...</div>
        <div id="questionContent" style="display: none;">
          <div class="question-type" id="questionType">å•é€‰é¢˜</div>
          <div class="question-text" id="questionText"></div>
          <div class="multi-select-hint" id="multiSelectHint" style="display: none;">ğŸ“ å¤šé€‰é¢˜æç¤ºï¼šå¯é€‰æ‹©å¤šä¸ªç­”æ¡ˆ</div>
          <div class="options-container" id="optionsContainer"></div>

          <div class="progress-container">
            <span class="progress-text" id="progressText">ç¬¬ <span id="currentQuestion">1</span> é¢˜ / å…± <span
                id="totalQuestions">0</span> é¢˜</span>
            <div>
              <button class="btn" id="submitBtn">æäº¤ç­”æ¡ˆ</button>
              <button class="btn btn-secondary" id="nextBtn" style="display: none;">ä¸‹ä¸€é¢˜</button>
            </div>
          </div>

          <div class="result-container" id="resultContainer">
            <div class="result-title">
              <i id="resultIcon">âœ“</i>
              <span id="resultTitle">å›ç­”æ­£ç¡®</span>
            </div>
            <div id="resultContent">
              <p><strong>æ­£ç¡®ç­”æ¡ˆï¼š</strong><span id="correctAnswer"></span></p>
              <p><strong>è§£æï¼š</strong><span id="explanation"></span></p>
            </div>
          </div>
        </div>
        <div class="error" id="errorMessage" style="display: none;">
          <p>é¢˜ç›®æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥</p>
          <button class="btn" id="retryButton" style="margin-top: 15px;">é‡æ–°åŠ è½½</button>
        </div>
      </div>
    </div>

    <!-- æ¨¡æ‹Ÿè€ƒè¯•é¡µé¢ -->
    <div class="tab-content" id="exam">
      <div id="examStartScreen">
        <h2 style="margin-bottom: 20px; color: #d32f2f;">æ¨¡æ‹Ÿè€ƒè¯•</h2>
        <div style="background-color: #f9f9f9; padding: 20px; border-radius: 10px; margin-bottom: 25px;">
          <h3 style="margin-bottom: 15px; color: #333;">è€ƒè¯•è¯´æ˜</h3>
          <ul style="padding-left: 20px; margin-bottom: 20px;">
            <li style="margin-bottom: 8px;">ä»é¢˜åº“ä¸­éšæœºæŠ½å–100é“é¢˜ç›®è¿›è¡Œæ¨¡æ‹Ÿè€ƒè¯•</li>
            <li style="margin-bottom: 8px;">è€ƒè¯•æ—¶é—´é™åˆ¶ï¼š100åˆ†é’Ÿï¼ˆæ¯é¢˜çº¦1åˆ†é’Ÿï¼‰</li>
            <li style="margin-bottom: 8px;">é¢˜å‹åŒ…å«å•é€‰é¢˜ã€å¤šé€‰é¢˜å’Œåˆ¤æ–­é¢˜</li>
            <li style="margin-bottom: 8px;">æäº¤è¯•å·åç³»ç»Ÿè‡ªåŠ¨è¯„åˆ†å¹¶è®°å½•æˆç»©</li>
            <li style="margin-bottom: 8px;">å¯ä»¥æŸ¥çœ‹å†å²è€ƒè¯•æˆç»©è®°å½•</li>
          </ul>
          <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 20px;">
            <div>
              <strong>é¢˜åº“æ€»æ•°ï¼š</strong><span id="totalQuestionCount">0</span> é¢˜
            </div>
            <button class="btn btn-success" id="startExamBtn">å¼€å§‹æ¨¡æ‹Ÿè€ƒè¯•</button>
          </div>
        </div>

        <!-- å†å²è€ƒè¯•è®°å½• -->
        <div class="exam-history" id="examHistoryContainer" style="display: none;">
          <h3 style="margin-bottom: 15px; color: #333;">å†å²è€ƒè¯•è®°å½•</h3>
          <div id="examHistoryList"></div>
        </div>
      </div>

      <!-- è€ƒè¯•è¿›è¡Œä¸­ç•Œé¢ -->
      <div id="examInProgress" style="display: none;">
        <div class="exam-info">
          <div class="exam-timer">
            <i>â±ï¸</i> å‰©ä½™æ—¶é—´ï¼š<span id="examTimer">100:00</span>
          </div>
          <div class="exam-progress">
            ç¬¬ <span id="examCurrentQuestion">1</span> é¢˜ / å…± <span id="examTotalQuestions">100</span> é¢˜
          </div>
        </div>

        <div class="question-container">
          <div class="question-type" id="examQuestionType">å•é€‰é¢˜</div>
          <div class="question-text" id="examQuestionText"></div>
          <div class="multi-select-hint" id="examMultiSelectHint" style="display: none;">ğŸ“ å¤šé€‰é¢˜æç¤ºï¼šå¯é€‰æ‹©å¤šä¸ªç­”æ¡ˆ</div>
          <div class="options-container" id="examOptionsContainer"></div>

          <div class="exam-actions">
            <div>
              <button class="btn btn-secondary" id="prevExamQuestionBtn" style="display: none;">ä¸Šä¸€é¢˜</button>
              <button class="btn" id="nextExamQuestionBtn">ä¸‹ä¸€é¢˜</button>
            </div>
            <div>
              <button class="btn btn-secondary" id="markExamQuestionBtn">æ ‡è®°æœ¬é¢˜</button>
              <button class="btn btn-success" id="submitExamBtn">æäº¤è¯•å·</button>
            </div>
          </div>
        </div>
      </div>

      <!-- è€ƒè¯•ç»“æœç•Œé¢ -->
      <div id="examResultScreen" style="display: none;">
        <div class="exam-result-container">
          <h2 style="color: #d32f2f;">æ¨¡æ‹Ÿè€ƒè¯•ç»“æœ</h2>
          <div class="exam-score" id="examFinalScore">0åˆ†</div>

          <div class="exam-stats">
            <div class="exam-stat-item">
              <div class="exam-stat-value" id="examCorrectCount">0</div>
              <div class="exam-stat-label">ç­”å¯¹é¢˜æ•°</div>
            </div>
            <div class="exam-stat-item">
              <div class="exam-stat-value" id="examWrongCount">0</div>
              <div class="exam-stat-label">ç­”é”™é¢˜æ•°</div>
            </div>
            <div class="exam-stat-item">
              <div class="exam-stat-value" id="examTotalTime">0åˆ†é’Ÿ</div>
              <div class="exam-stat-label">ç”¨æ—¶</div>
            </div>
          </div>

          <div style="margin: 25px 0;">
            <p><strong>æ­£ç¡®ç‡ï¼š</strong><span id="examAccuracy">0%</span></p>
            <p><strong>è€ƒè¯•æ—¶é—´ï¼š</strong><span id="examDate">-</span></p>
            <p><strong>å¤‡æ³¨ï¼š</strong><span id="examRemark">-</span></p>
          </div>

          <div class="exam-actions">
            <button class="btn btn-secondary" id="reviewExamBtn">æŸ¥çœ‹é”™é¢˜è§£æ</button>
            <button class="btn" id="newExamBtn">é‡æ–°å¼€å§‹è€ƒè¯•</button>
          </div>
        </div>
      </div>
    </div>

    <!-- é”™é¢˜æœ¬é¡µé¢ -->
    <div class="tab-content" id="wrong">
      <div class="filter-container">
        <select class="filter-select" id="questionTypeFilter">
          <option value="all">å…¨éƒ¨é¢˜å‹</option>
          <option value="å•é€‰é¢˜">å•é€‰é¢˜</option>
          <option value="å¤šé€‰é¢˜">å¤šé€‰é¢˜</option>
          <option value="åˆ¤æ–­é¢˜">åˆ¤æ–­é¢˜</option>
        </select>
        <button class="clear-wrong-btn" id="clearWrongBtn">æ¸…ç©ºé”™é¢˜æœ¬</button>
      </div>

      <div class="wrong-questions-list" id="wrongQuestionsList">
        <div class="no-wrong-questions" id="noWrongQuestions">
          <p>ğŸ‰ æš‚æ— é”™é¢˜è®°å½•</p>
          <p style="margin-top: 10px; font-size: 14px;">å¿«å»ç­”é¢˜ç»ƒä¹ å§ï¼</p>
        </div>
      </div>
    </div>

    <!-- å­¦ä¹ ç»Ÿè®¡é¡µé¢ -->
    <div class="tab-content" id="stats">
      <div class="stats-container">
        <div class="stat-item total">
          <div class="stat-value" id="totalAnswered">0</div>
          <div class="stat-label">å·²ç­”é¢˜æ•°</div>
        </div>
        <div class="stat-item correct">
          <div class="stat-value" id="correctCount">0</div>
          <div class="stat-label">ç­”å¯¹é¢˜æ•°</div>
          <div class="percentage" id="correctPercentage">0%</div>
        </div>
        <div class="stat-item wrong-stat">
          <div class="stat-value" id="wrongCount">0</div>
          <div class="stat-label">ç­”é”™é¢˜æ•°</div>
          <div class="percentage" id="wrongPercentage">0%</div>
        </div>
      </div>

      <div class="progress-container">
        <span>ğŸ“Š å­¦ä¹ è¿›åº¦</span>
        <span id="progressPercentage">0%</span>
      </div>

      <!-- è€ƒè¯•ç»Ÿè®¡ -->
      <div style="margin-top: 30px;">
        <h3 style="margin-bottom: 15px; color: #333;">æ¨¡æ‹Ÿè€ƒè¯•ç»Ÿè®¡</h3>
        <div class="stats-container">
          <div class="stat-item total">
            <div class="stat-value" id="totalExams">0</div>
            <div class="stat-label">è€ƒè¯•æ¬¡æ•°</div>
          </div>
          <div class="stat-item correct">
            <div class="stat-value" id="bestExamScore">0</div>
            <div class="stat-label">æœ€é«˜åˆ†</div>
          </div>
          <div class="stat-item wrong-stat">
            <div class="stat-value" id="avgExamScore">0</div>
            <div class="stat-label">å¹³å‡åˆ†</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // å…¨å±€å˜é‡
    let questions = [];
    let currentQuestionIndex = 0;
    let userAnswers = [];
    let wrongQuestions = JSON.parse(localStorage.getItem('wrongQuestions')) || [];
    let studyStats = JSON.parse(localStorage.getItem('studyStats')) || {
      totalAnswered: 0,
      correctCount: 0,
      wrongCount: 0,
      answeredQuestions: []
    };
    let examStats = JSON.parse(localStorage.getItem('examStats')) || {
      totalExams: 0,
      bestScore: 0,
      totalScore: 0,
      examHistory: []
    };

    // æ¨¡æ‹Ÿè€ƒè¯•ç›¸å…³å˜é‡
    let examQuestions = [];
    let examCurrentIndex = 0;
    let examAnswers = [];
    let examMarkedQuestions = [];
    let examStartTime = null;
    let examTimerInterval = null;
    let examTimeLeft = 100 * 60; // 100åˆ†é’Ÿï¼Œå•ä½ç§’

    // é˜²æ­¢ç§»åŠ¨ç«¯åŒå‡»ç¼©æ”¾
    let lastTouchTime = 0;
    document.addEventListener('touchend', function (event) {
      const now = Date.now();
      if (now - lastTouchTime <= 300) {
        event.preventDefault();
      }
      lastTouchTime = now;
    }, false);

    // é˜²æ­¢æ‰‹åŠ¿ç¼©æ”¾
    document.addEventListener('gesturestart', function (e) {
      e.preventDefault();
    });

    // åˆå§‹åŒ–é¡µé¢
    document.addEventListener('DOMContentLoaded', function () {
      // æ·»åŠ è§¦æ‘¸äº‹ä»¶ä¼˜åŒ–
      const touchElements = document.querySelectorAll('button, .option, .tab');
      touchElements.forEach(el => {
        el.addEventListener('touchstart', function () {
          this.style.transform = 'scale(0.98)';
        });

        el.addEventListener('touchend', function () {
          this.style.transform = '';
        });

        el.addEventListener('touchcancel', function () {
          this.style.transform = '';
        });
      });

      loadQuestionsData();
      setupEventListeners();
      updateExamHistoryDisplay();
      updateExamStatsDisplay();
    });

    // åŠ è½½é¢˜ç›®æ•°æ®
    async function loadQuestionsData() {
      try {
        const response = await fetch('questions.json');
        if (!response.ok) {
          throw new Error('ç½‘ç»œå“åº”ä¸æ­£å¸¸');
        }
        const data = await response.json();
        questions = data.questions;

        // æ›´æ–°é¢˜åº“æ€»æ•°æ˜¾ç¤º
        document.getElementById('totalQuestionCount').textContent = questions.length;

        // éšè—åŠ è½½æç¤ºï¼Œæ˜¾ç¤ºé¢˜ç›®å†…å®¹
        document.getElementById('loadingMessage').style.display = 'none';
        document.getElementById('questionContent').style.display = 'block';
        document.getElementById('successMessage').style.display = 'block';

        // 3ç§’åéšè—æˆåŠŸæ¶ˆæ¯
        setTimeout(() => {
          document.getElementById('successMessage').style.display = 'none';
        }, 3000);

        initPracticePage();
        initWrongQuestionsPage();
        initStatsPage();
      } catch (error) {
        console.error('åŠ è½½é¢˜ç›®æ•°æ®å¤±è´¥:', error);
        document.getElementById('loadingMessage').style.display = 'none';
        document.getElementById('errorMessage').style.display = 'block';
      }
    }

    // åˆå§‹åŒ–ç­”é¢˜é¡µé¢
    function initPracticePage() {
      displayQuestion(currentQuestionIndex);
      updateProgress();
    }

    // æ˜¾ç¤ºé¢˜ç›®
    function displayQuestion(index) {
      if (index >= questions.length) {
        document.getElementById('questionText').textContent = "ğŸ‰ æ­å–œæ‚¨å·²å®Œæˆæ‰€æœ‰é¢˜ç›®ï¼";
        document.getElementById('questionType').textContent = "å®Œæˆ";
        document.getElementById('optionsContainer').innerHTML = "";
        document.getElementById('submitBtn').style.display = "none";
        document.getElementById('nextBtn').style.display = "none";
        document.getElementById('progressText').textContent = "å·²å®Œæˆæ‰€æœ‰é¢˜ç›®";
        return;
      }

      const question = questions[index];

      document.getElementById('questionType').textContent = question.type;
      document.getElementById('questionText').textContent = question.text;

      // æ˜¾ç¤ºå¤šé€‰é¢˜æç¤º
      if (question.type === 'å¤šé€‰é¢˜') {
        document.getElementById('multiSelectHint').style.display = 'block';
      } else {
        document.getElementById('multiSelectHint').style.display = 'none';
      }

      const optionsContainer = document.getElementById('optionsContainer');
      optionsContainer.innerHTML = "";

      for (const key in question.options) {
        const optionDiv = document.createElement('div');
        optionDiv.className = 'option';

        const input = document.createElement('input');
        input.type = question.type === 'å¤šé€‰é¢˜' ? 'checkbox' : 'radio';
        input.name = 'answer';
        input.value = key;
        input.id = `option-${key}`;

        const label = document.createElement('label');
        label.htmlFor = `option-${key}`;
        label.innerHTML = `<span class="option-label">${key}.</span> ${question.options[key]}`;

        // ä¿®å¤å•é€‰å’Œåˆ¤æ–­é¢˜çš„é€‰æ‹©é€»è¾‘
        optionDiv.addEventListener('click', function (e) {
          // é˜²æ­¢äº‹ä»¶å†’æ³¡å¯¼è‡´å¤šæ¬¡è§¦å‘
          if (e.target !== input && e.target.tagName !== 'LABEL') {
            if (question.type === 'å•é€‰é¢˜' || question.type === 'åˆ¤æ–­é¢˜') {
              // å¯¹äºå•é€‰/åˆ¤æ–­é¢˜ï¼šå§‹ç»ˆé€‰ä¸­å½“å‰ç‚¹å‡»çš„é€‰é¡¹ï¼Œä¸æä¾›å–æ¶ˆåŠŸèƒ½
              // å…ˆå–æ¶ˆæ‰€æœ‰é€‰é¡¹çš„é€‰ä¸­çŠ¶æ€
              const allOptions = document.querySelectorAll('.option');
              allOptions.forEach(opt => {
                opt.classList.remove('selected');
                const input = opt.querySelector('input');
                if (input) input.checked = false;
              });

              // é€‰ä¸­å½“å‰é€‰é¡¹
              input.checked = true;
              this.classList.add('selected');
            } else {
              // å¤šé€‰é¢˜ï¼šåˆ‡æ¢å½“å‰é€‰é¡¹çš„é€‰ä¸­çŠ¶æ€
              input.checked = !input.checked;
              this.classList.toggle('selected', input.checked);
            }
          }
        });

        // æ·»åŠ è¾“å…¥æ¡†å˜åŒ–äº‹ä»¶ï¼Œç¡®ä¿é€‰é¡¹çŠ¶æ€åŒæ­¥
        input.addEventListener('change', function () {
          optionDiv.classList.toggle('selected', this.checked);

          // å¯¹äºå•é€‰/åˆ¤æ–­é¢˜ï¼Œå½“é€‰é¡¹æ”¹å˜æ—¶ï¼Œç¡®ä¿åªæœ‰ä¸€ä¸ªé€‰é¡¹è¢«é€‰ä¸­
          if (question.type === 'å•é€‰é¢˜' || question.type === 'åˆ¤æ–­é¢˜') {
            if (this.checked) {
              const allOptions = document.querySelectorAll('.option');
              allOptions.forEach(opt => {
                if (opt !== optionDiv) {
                  opt.classList.remove('selected');
                  const otherInput = opt.querySelector('input');
                  if (otherInput) otherInput.checked = false;
                }
              });
            }
          }
        });

        optionDiv.appendChild(input);
        optionDiv.appendChild(label);
        optionsContainer.appendChild(optionDiv);
      }

      document.getElementById('resultContainer').style.display = 'none';
      document.getElementById('submitBtn').style.display = 'inline-block';
      document.getElementById('nextBtn').style.display = 'none';
    }

    // æ›´æ–°è¿›åº¦æ˜¾ç¤º
    function updateProgress() {
      document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
      document.getElementById('totalQuestions').textContent = questions.length;
    }

    // åˆå§‹åŒ–é”™é¢˜æœ¬é¡µé¢
    function initWrongQuestionsPage() {
      displayWrongQuestions();
    }

    // æ˜¾ç¤ºé”™é¢˜
    function displayWrongQuestions() {
      const wrongQuestionsList = document.getElementById('wrongQuestionsList');
      const noWrongQuestions = document.getElementById('noWrongQuestions');
      const filterValue = document.getElementById('questionTypeFilter').value;

      let filteredWrongQuestions = wrongQuestions;
      if (filterValue !== 'all') {
        filteredWrongQuestions = wrongQuestions.filter(q => q.type === filterValue);
      }

      if (filteredWrongQuestions.length === 0) {
        noWrongQuestions.style.display = 'block';
        wrongQuestionsList.innerHTML = '';
        wrongQuestionsList.appendChild(noWrongQuestions);
      } else {
        noWrongQuestions.style.display = 'none';
        wrongQuestionsList.innerHTML = '';

        filteredWrongQuestions.forEach((wrongQuestion, index) => {
          const wrongQuestionItem = document.createElement('div');
          wrongQuestionItem.className = 'wrong-question-item';

          let optionsHtml = '';
          for (const key in wrongQuestion.options) {
            const isChecked = wrongQuestion.userAnswer && wrongQuestion.userAnswer.includes(key);
            optionsHtml += `
              <div class="option" style="pointer-events: none; background-color: ${isChecked ? '#ffe0b2' : '#f9f9f9'};">
                <input type="${wrongQuestion.type === 'å¤šé€‰é¢˜' ? 'checkbox' : 'radio'}" disabled ${isChecked ? 'checked' : ''}>
                <label><span class="option-label">${key}.</span> ${wrongQuestion.options[key]}</label>
              </div>
            `;
          }

          wrongQuestionItem.innerHTML = `
            <div class="question-type">${wrongQuestion.type}</div>
            <div class="question-text">${wrongQuestion.text}</div>
            <div class="options-container">${optionsHtml}</div>
            <div style="margin-top: 15px; padding: 10px; background-color: #f5f5f5; border-radius: 5px;">
              <p><strong>æ‚¨çš„ç­”æ¡ˆï¼š</strong><span style="color: #f44336;">${wrongQuestion.userAnswer || 'æœªä½œç­”'}</span></p>
              <p><strong>æ­£ç¡®ç­”æ¡ˆï¼š</strong><span style="color: #4caf50;">${wrongQuestion.answer}</span></p>
            </div>
            <div style="margin-top: 10px;">
              <strong>è§£æï¼š</strong>${wrongQuestion.explanation}
            </div>
            <button class="btn" style="margin-top: 15px;" onclick="redoTopic(${wrongQuestion.originalIndex})">é‡æ–°ç»ƒä¹ æ­¤é¢˜</button>
          `;

          wrongQuestionsList.appendChild(wrongQuestionItem);
        });
      }
    }

    // åˆå§‹åŒ–ç»Ÿè®¡é¡µé¢
    function initStatsPage() {
      updateStats();
      updateExamStatsDisplay();
    }

    // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
    function updateStats() {
      const totalAnswered = studyStats.totalAnswered;
      const correctCount = studyStats.correctCount;
      const wrongCount = studyStats.wrongCount;

      document.getElementById('totalAnswered').textContent = totalAnswered;
      document.getElementById('correctCount').textContent = correctCount;
      document.getElementById('wrongCount').textContent = wrongCount;

      const correctPercentage = totalAnswered > 0 ? Math.round((correctCount / totalAnswered) * 100) : 0;
      const wrongPercentage = totalAnswered > 0 ? Math.round((wrongCount / totalAnswered) * 100) : 0;
      const progressPercentage = questions.length > 0 ? Math.round((studyStats.answeredQuestions.length / questions.length) * 100) : 0;

      document.getElementById('correctPercentage').textContent = `${correctPercentage}%`;
      document.getElementById('wrongPercentage').textContent = `${wrongPercentage}%`;
      document.getElementById('progressPercentage').textContent = `${progressPercentage}%`;
    }

    // æ›´æ–°è€ƒè¯•ç»Ÿè®¡æ˜¾ç¤º
    function updateExamStatsDisplay() {
      document.getElementById('totalExams').textContent = examStats.totalExams;
      document.getElementById('bestExamScore').textContent = examStats.bestScore;
      document.getElementById('avgExamScore').textContent = examStats.totalExams > 0 ?
        Math.round(examStats.totalScore / examStats.totalExams) : 0;
    }

    // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
    function setupEventListeners() {
      // æ ‡ç­¾é¡µåˆ‡æ¢
      document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', function () {
          document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
          document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

          this.classList.add('active');
          document.getElementById(this.dataset.tab).classList.add('active');

          if (this.dataset.tab === 'wrong') {
            displayWrongQuestions();
          }

          if (this.dataset.tab === 'stats') {
            updateStats();
            updateExamStatsDisplay();
          }
        });
      });

      // ç»ƒä¹ é¡µé¢äº‹ä»¶
      document.getElementById('submitBtn').addEventListener('click', checkAnswer);
      document.getElementById('nextBtn').addEventListener('click', nextQuestion);
      document.getElementById('questionTypeFilter').addEventListener('change', displayWrongQuestions);
      document.getElementById('clearWrongBtn').addEventListener('click', clearWrongQuestions);
      document.getElementById('retryButton').addEventListener('click', function () {
        document.getElementById('errorMessage').style.display = 'none';
        document.getElementById('loadingMessage').style.display = 'block';
        loadQuestionsData();
      });

      // æ¨¡æ‹Ÿè€ƒè¯•äº‹ä»¶
      document.getElementById('startExamBtn').addEventListener('click', startExam);
      document.getElementById('prevExamQuestionBtn').addEventListener('click', prevExamQuestion);
      document.getElementById('nextExamQuestionBtn').addEventListener('click', nextExamQuestion);
      document.getElementById('markExamQuestionBtn').addEventListener('click', toggleMarkExamQuestion);
      document.getElementById('submitExamBtn').addEventListener('click', submitExam);
      document.getElementById('reviewExamBtn').addEventListener('click', reviewExam);
      document.getElementById('newExamBtn').addEventListener('click', resetExam);
    }

    // æ£€æŸ¥ç­”æ¡ˆ
    function checkAnswer() {
      const selectedOptions = document.querySelectorAll('input[name="answer"]:checked');

      if (selectedOptions.length === 0) {
        alert('è¯·é€‰æ‹©ç­”æ¡ˆï¼');
        return;
      }

      const userAnswer = Array.from(selectedOptions).map(option => option.value).sort().join('');
      const correctAnswer = questions[currentQuestionIndex].answer;
      const isCorrect = userAnswer === correctAnswer;

      const resultContainer = document.getElementById('resultContainer');
      resultContainer.style.display = 'block';

      if (isCorrect) {
        resultContainer.className = 'result-container correct';
        document.getElementById('resultIcon').textContent = 'âœ“';
        document.getElementById('resultTitle').textContent = 'å›ç­”æ­£ç¡®ï¼';
      } else {
        resultContainer.className = 'result-container wrong';
        document.getElementById('resultIcon').textContent = 'âœ—';
        document.getElementById('resultTitle').textContent = 'å›ç­”é”™è¯¯ï¼';

        if (!wrongQuestions.some(q => q.originalIndex === currentQuestionIndex)) {
          wrongQuestions.push({
            ...questions[currentQuestionIndex],
            userAnswer: userAnswer,
            originalIndex: currentQuestionIndex
          });
          localStorage.setItem('wrongQuestions', JSON.stringify(wrongQuestions));
        }
      }

      document.getElementById('correctAnswer').textContent = correctAnswer;
      document.getElementById('explanation').textContent = questions[currentQuestionIndex].explanation;

      document.getElementById('submitBtn').style.display = 'none';
      document.getElementById('nextBtn').style.display = 'inline-block';

      userAnswers[currentQuestionIndex] = userAnswer;
      updateStudyStats(isCorrect);
    }

    // ä¸‹ä¸€é¢˜
    function nextQuestion() {
      currentQuestionIndex++;

      if (currentQuestionIndex < questions.length) {
        displayQuestion(currentQuestionIndex);
        updateProgress();
      } else {
        document.getElementById('questionText').textContent = "ğŸ‰ æ­å–œæ‚¨å·²å®Œæˆæ‰€æœ‰é¢˜ç›®ï¼";
        document.getElementById('questionType').textContent = "å®Œæˆ";
        document.getElementById('optionsContainer').innerHTML = "";
        document.getElementById('submitBtn').style.display = "none";
        document.getElementById('nextBtn').style.display = "none";
        document.getElementById('resultContainer').style.display = "none";
        document.getElementById('progressText').textContent = "å·²å®Œæˆæ‰€æœ‰é¢˜ç›®";
      }
    }

    // æ›´æ–°å­¦ä¹ ç»Ÿè®¡
    function updateStudyStats(isCorrect) {
      if (!studyStats.answeredQuestions.includes(currentQuestionIndex)) {
        studyStats.totalAnswered++;
        studyStats.answeredQuestions.push(currentQuestionIndex);

        if (isCorrect) {
          studyStats.correctCount++;
        } else {
          studyStats.wrongCount++;
        }

        localStorage.setItem('studyStats', JSON.stringify(studyStats));
        updateStats();
      }
    }

    // é‡æ–°ç»ƒä¹ é”™é¢˜
    window.redoTopic = function (originalIndex) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

      document.querySelector('.tab[data-tab="practice"]').classList.add('active');
      document.getElementById('practice').classList.add('active');

      currentQuestionIndex = originalIndex;
      displayQuestion(currentQuestionIndex);
      updateProgress();

      // æ»šåŠ¨åˆ°é¡¶éƒ¨
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // æ¸…ç©ºé”™é¢˜æœ¬
    function clearWrongQuestions() {
      if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰é”™é¢˜è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚')) {
        wrongQuestions = [];
        localStorage.setItem('wrongQuestions', JSON.stringify(wrongQuestions));
        displayWrongQuestions();
      }
    }

    // ==================== æ¨¡æ‹Ÿè€ƒè¯•åŠŸèƒ½ ====================

    // å¼€å§‹æ¨¡æ‹Ÿè€ƒè¯•
    function startExam() {
      // æ£€æŸ¥é¢˜ç›®æ•°é‡
      if (questions.length === 0) {
        alert('é¢˜åº“ä¸­æ²¡æœ‰é¢˜ç›®ï¼Œæ— æ³•å¼€å§‹è€ƒè¯•ï¼');
        return;
      }

      // éšæœºæŠ½å–100é¢˜ï¼ˆå¦‚æœé¢˜åº“ä¸è¶³100é¢˜ï¼Œåˆ™å…¨éƒ¨æŠ½å–ï¼‰
      const examCount = Math.min(100, questions.length);
      examQuestions = getRandomQuestions(questions, examCount);

      // åˆå§‹åŒ–è€ƒè¯•çŠ¶æ€
      examCurrentIndex = 0;
      examAnswers = new Array(examQuestions.length).fill('');
      examMarkedQuestions = [];
      examStartTime = new Date();
      examTimeLeft = 100 * 60; // é‡ç½®ä¸º100åˆ†é’Ÿ

      // æ˜¾ç¤ºè€ƒè¯•ç•Œé¢
      document.getElementById('examStartScreen').style.display = 'none';
      document.getElementById('examInProgress').style.display = 'block';
      document.getElementById('examResultScreen').style.display = 'none';

      // å¼€å§‹è®¡æ—¶å™¨
      startExamTimer();

      // æ˜¾ç¤ºç¬¬ä¸€é¢˜
      displayExamQuestion(0);
    }

    // éšæœºæŠ½å–é¢˜ç›®
    function getRandomQuestions(allQuestions, count) {
      // å¤åˆ¶é¢˜ç›®æ•°ç»„
      const shuffled = [...allQuestions];

      // Fisher-Yatesæ´—ç‰Œç®—æ³•
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }

      // è¿”å›å‰countä¸ªé¢˜ç›®
      return shuffled.slice(0, count);
    }

    // å¼€å§‹è€ƒè¯•è®¡æ—¶å™¨
    function startExamTimer() {
      // æ¸…é™¤ä¹‹å‰çš„è®¡æ—¶å™¨
      if (examTimerInterval) {
        clearInterval(examTimerInterval);
      }

      // æ›´æ–°è®¡æ—¶å™¨æ˜¾ç¤º
      updateTimerDisplay();

      // æ¯ç§’æ›´æ–°ä¸€æ¬¡è®¡æ—¶å™¨
      examTimerInterval = setInterval(() => {
        examTimeLeft--;
        updateTimerDisplay();

        // æ—¶é—´åˆ°ï¼Œè‡ªåŠ¨äº¤å·
        if (examTimeLeft <= 0) {
          clearInterval(examTimerInterval);
          submitExam();
        }
      }, 1000);
    }

    // æ›´æ–°è®¡æ—¶å™¨æ˜¾ç¤º
    function updateTimerDisplay() {
      const minutes = Math.floor(examTimeLeft / 60);
      const seconds = examTimeLeft % 60;
      document.getElementById('examTimer').textContent =
        `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }

    // æ˜¾ç¤ºè€ƒè¯•é¢˜ç›®
    function displayExamQuestion(index) {
      if (index < 0 || index >= examQuestions.length) return;

      examCurrentIndex = index;
      const question = examQuestions[index];

      // æ›´æ–°é¢˜ç›®ä¿¡æ¯
      document.getElementById('examQuestionType').textContent = question.type;
      document.getElementById('examQuestionText').textContent = question.text;
      document.getElementById('examCurrentQuestion').textContent = index + 1;
      document.getElementById('examTotalQuestions').textContent = examQuestions.length;

      // æ˜¾ç¤ºå¤šé€‰é¢˜æç¤º
      if (question.type === 'å¤šé€‰é¢˜') {
        document.getElementById('examMultiSelectHint').style.display = 'block';
      } else {
        document.getElementById('examMultiSelectHint').style.display = 'none';
      }

      // æ˜¾ç¤ºé€‰é¡¹
      const optionsContainer = document.getElementById('examOptionsContainer');
      optionsContainer.innerHTML = '';

      for (const key in question.options) {
        const optionDiv = document.createElement('div');
        optionDiv.className = 'option';
        if (examMarkedQuestions.includes(index)) {
          optionDiv.style.border = '2px solid #ff9800';
        }

        const input = document.createElement('input');
        input.type = question.type === 'å¤šé€‰é¢˜' ? 'checkbox' : 'radio';
        input.name = 'exam-answer';
        input.value = key;
        input.id = `exam-option-${index}-${key}`;

        // å¦‚æœä¹‹å‰å·²ç»é€‰æ‹©è¿‡ï¼Œåˆ™æ¢å¤é€‰æ‹©çŠ¶æ€
        if (examAnswers[index] && examAnswers[index].includes(key)) {
          input.checked = true;
          optionDiv.classList.add('selected');
        }

        const label = document.createElement('label');
        label.htmlFor = `exam-option-${index}-${key}`;
        label.innerHTML = `<span class="option-label">${key}.</span> ${question.options[key]}`;

        // æ·»åŠ ç‚¹å‡»äº‹ä»¶
        optionDiv.addEventListener('click', function (e) {
          if (e.target !== input && e.target.tagName !== 'LABEL') {
            if (question.type === 'å•é€‰é¢˜' || question.type === 'åˆ¤æ–­é¢˜') {
              // å•é€‰/åˆ¤æ–­é¢˜ï¼šå…ˆå–æ¶ˆæ‰€æœ‰é€‰é¡¹ï¼Œå†é€‰ä¸­å½“å‰é€‰é¡¹
              const allOptions = document.querySelectorAll('#examOptionsContainer .option');
              allOptions.forEach(opt => {
                opt.classList.remove('selected');
                const input = opt.querySelector('input');
                if (input) input.checked = false;
              });

              input.checked = true;
              this.classList.add('selected');
              saveExamAnswer(index, key);
            } else {
              // å¤šé€‰é¢˜ï¼šåˆ‡æ¢é€‰ä¸­çŠ¶æ€
              input.checked = !input.checked;
              this.classList.toggle('selected', input.checked);

              // è·å–æ‰€æœ‰é€‰ä¸­çš„é€‰é¡¹
              const selectedOptions = document.querySelectorAll(`#examOptionsContainer input[name="exam-answer"]:checked`);
              const selectedValues = Array.from(selectedOptions).map(opt => opt.value).sort().join('');
              saveExamAnswer(index, selectedValues);
            }
          }
        });

        // æ·»åŠ è¾“å…¥æ¡†å˜åŒ–äº‹ä»¶
        input.addEventListener('change', function () {
          optionDiv.classList.toggle('selected', this.checked);

          if (question.type === 'å•é€‰é¢˜' || question.type === 'åˆ¤æ–­é¢˜') {
            if (this.checked) {
              const allOptions = document.querySelectorAll('#examOptionsContainer .option');
              allOptions.forEach(opt => {
                if (opt !== optionDiv) {
                  opt.classList.remove('selected');
                  const otherInput = opt.querySelector('input');
                  if (otherInput) otherInput.checked = false;
                }
              });
              saveExamAnswer(index, key);
            }
          } else {
            // å¤šé€‰é¢˜ï¼šè·å–æ‰€æœ‰é€‰ä¸­çš„é€‰é¡¹
            const selectedOptions = document.querySelectorAll(`#examOptionsContainer input[name="exam-answer"]:checked`);
            const selectedValues = Array.from(selectedOptions).map(opt => opt.value).sort().join('');
            saveExamAnswer(index, selectedValues);
          }
        });

        optionDiv.appendChild(input);
        optionDiv.appendChild(label);
        optionsContainer.appendChild(optionDiv);
      }

      // æ›´æ–°æŒ‰é’®çŠ¶æ€
      document.getElementById('prevExamQuestionBtn').style.display = index > 0 ? 'inline-block' : 'none';
      document.getElementById('nextExamQuestionBtn').style.display = index < examQuestions.length - 1 ? 'inline-block' : 'none';
      document.getElementById('markExamQuestionBtn').textContent = examMarkedQuestions.includes(index) ? 'å–æ¶ˆæ ‡è®°' : 'æ ‡è®°æœ¬é¢˜';
    }

    // ä¿å­˜è€ƒè¯•ç­”æ¡ˆ
    function saveExamAnswer(index, answer) {
      examAnswers[index] = answer;
    }

    // ä¸Šä¸€é¢˜
    function prevExamQuestion() {
      if (examCurrentIndex > 0) {
        displayExamQuestion(examCurrentIndex - 1);
      }
    }

    // ä¸‹ä¸€é¢˜
    function nextExamQuestion() {
      if (examCurrentIndex < examQuestions.length - 1) {
        displayExamQuestion(examCurrentIndex + 1);
      }
    }

    // æ ‡è®°/å–æ¶ˆæ ‡è®°é¢˜ç›®
    function toggleMarkExamQuestion() {
      const index = examCurrentIndex;
      if (examMarkedQuestions.includes(index)) {
        // å–æ¶ˆæ ‡è®°
        examMarkedQuestions = examMarkedQuestions.filter(i => i !== index);
      } else {
        // æ·»åŠ æ ‡è®°
        examMarkedQuestions.push(index);
      }

      // æ›´æ–°æŒ‰é’®æ–‡æœ¬
      document.getElementById('markExamQuestionBtn').textContent =
        examMarkedQuestions.includes(index) ? 'å–æ¶ˆæ ‡è®°' : 'æ ‡è®°æœ¬é¢˜';

      // æ›´æ–°é¢˜ç›®æ˜¾ç¤ºï¼ˆæ·»åŠ æˆ–ç§»é™¤æ ‡è®°æ ·å¼ï¼‰
      const questionElement = document.querySelector('.question-container');
      if (examMarkedQuestions.includes(index)) {
        questionElement.style.border = '2px solid #ff9800';
        questionElement.style.borderRadius = '8px';
        questionElement.style.padding = '10px';
      } else {
        questionElement.style.border = 'none';
        questionElement.style.padding = '0';
      }
    }

    // æäº¤è¯•å·
    function submitExam() {
      // æ¸…é™¤è®¡æ—¶å™¨
      if (examTimerInterval) {
        clearInterval(examTimerInterval);
        examTimerInterval = null;
      }

      // è®¡ç®—å¾—åˆ†
      let correctCount = 0;
      let wrongQuestionsList = [];

      for (let i = 0; i < examQuestions.length; i++) {
        const question = examQuestions[i];
        const userAnswer = examAnswers[i] || '';
        const correctAnswer = question.answer;

        if (userAnswer === correctAnswer) {
          correctCount++;
        } else {
          wrongQuestionsList.push({
            ...question,
            userAnswer: userAnswer,
            originalIndex: i
          });
        }
      }

      // è®¡ç®—åˆ†æ•°ï¼ˆæ¯é¢˜1åˆ†ï¼‰
      const score = correctCount;
      const totalQuestions = examQuestions.length;
      const accuracy = Math.round((correctCount / totalQuestions) * 100);

      // è®¡ç®—ç”¨æ—¶
      const endTime = new Date();
      const timeSpent = Math.round((endTime - examStartTime) / 1000); // ç§’
      const minutesSpent = Math.floor(timeSpent / 60);
      const secondsSpent = timeSpent % 60;

      // ç”Ÿæˆè€ƒè¯•è®°å½•
      const examRecord = {
        id: Date.now(),
        date: new Date().toLocaleString(),
        score: score,
        totalQuestions: totalQuestions,
        correctCount: correctCount,
        wrongCount: totalQuestions - correctCount,
        accuracy: accuracy,
        timeSpent: `${minutesSpent}åˆ†${secondsSpent}ç§’`,
        remark: getExamRemark(accuracy)
      };

      // æ›´æ–°è€ƒè¯•ç»Ÿè®¡
      examStats.totalExams++;
      examStats.totalScore += score;
      if (score > examStats.bestScore) {
        examStats.bestScore = score;
      }
      examStats.examHistory.unshift(examRecord);

      // åªä¿ç•™æœ€è¿‘10æ¬¡è€ƒè¯•è®°å½•
      if (examStats.examHistory.length > 10) {
        examStats.examHistory = examStats.examHistory.slice(0, 10);
      }

      // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
      localStorage.setItem('examStats', JSON.stringify(examStats));

      // æ˜¾ç¤ºè€ƒè¯•ç»“æœ
      showExamResult(examRecord);

      // å°†é”™é¢˜æ·»åŠ åˆ°é”™é¢˜æœ¬
      wrongQuestionsList.forEach(wrongQuestion => {
        if (!wrongQuestions.some(q => q.text === wrongQuestion.text)) {
          wrongQuestions.push(wrongQuestion);
        }
      });
      localStorage.setItem('wrongQuestions', JSON.stringify(wrongQuestions));

      // æ›´æ–°ç»Ÿè®¡æ˜¾ç¤º
      updateExamStatsDisplay();
    }

    // æ ¹æ®æ­£ç¡®ç‡ç”Ÿæˆè¯„è¯­
    function getExamRemark(accuracy) {
      if (accuracy >= 90) return 'ä¼˜ç§€ï¼ç»§ç»­ä¿æŒï¼';
      if (accuracy >= 80) return 'è‰¯å¥½ï¼è¿˜æœ‰æå‡ç©ºé—´ï¼';
      if (accuracy >= 70) return 'ä¸­ç­‰ï¼éœ€è¦åŠ å¼ºç»ƒä¹ ï¼';
      if (accuracy >= 60) return 'åŠæ ¼ï¼éœ€è¦é‡ç‚¹å¤ä¹ ï¼';
      return 'ä¸åŠæ ¼ï¼å»ºè®®ç³»ç»Ÿå­¦ä¹ ï¼';
    }

    // æ˜¾ç¤ºè€ƒè¯•ç»“æœ
    function showExamResult(examRecord) {
      document.getElementById('examInProgress').style.display = 'none';
      document.getElementById('examResultScreen').style.display = 'block';

      document.getElementById('examFinalScore').textContent = `${examRecord.score}åˆ†`;
      document.getElementById('examCorrectCount').textContent = examRecord.correctCount;
      document.getElementById('examWrongCount').textContent = examRecord.wrongCount;
      document.getElementById('examTotalTime').textContent = examRecord.timeSpent;
      document.getElementById('examAccuracy').textContent = `${examRecord.accuracy}%`;
      document.getElementById('examDate').textContent = examRecord.date;
      document.getElementById('examRemark').textContent = examRecord.remark;

      // æ›´æ–°å†å²è®°å½•æ˜¾ç¤º
      updateExamHistoryDisplay();
    }

    // æ›´æ–°å†å²è€ƒè¯•è®°å½•æ˜¾ç¤º
    function updateExamHistoryDisplay() {
      const examHistoryList = document.getElementById('examHistoryList');
      const examHistoryContainer = document.getElementById('examHistoryContainer');

      if (examStats.examHistory.length === 0) {
        examHistoryContainer.style.display = 'none';
        return;
      }

      examHistoryContainer.style.display = 'block';
      examHistoryList.innerHTML = '';

      examStats.examHistory.forEach(record => {
        const historyItem = document.createElement('div');
        historyItem.className = 'exam-history-item';

        historyItem.innerHTML = `
          <div class="exam-history-header">
            <div class="exam-history-score">${record.score}åˆ†</div>
            <div class="exam-history-date">${record.date}</div>
          </div>
          <div class="exam-history-stats">
            <div>æ­£ç¡®ï¼š${record.correctCount}é¢˜</div>
            <div>é”™è¯¯ï¼š${record.wrongCount}é¢˜</div>
            <div>æ­£ç¡®ç‡ï¼š${record.accuracy}%</div>
            <div>ç”¨æ—¶ï¼š${record.timeSpent}</div>
          </div>
        `;

        examHistoryList.appendChild(historyItem);
      });
    }

    // æŸ¥çœ‹é”™é¢˜è§£æ
    function reviewExam() {
      // åˆ‡æ¢åˆ°é”™é¢˜æœ¬é¡µé¢
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

      document.querySelector('.tab[data-tab="wrong"]').classList.add('active');
      document.getElementById('wrong').classList.add('active');

      // æ˜¾ç¤ºé”™é¢˜
      displayWrongQuestions();

      // æ»šåŠ¨åˆ°é¡¶éƒ¨
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // é‡æ–°å¼€å§‹è€ƒè¯•
    function resetExam() {
      document.getElementById('examResultScreen').style.display = 'none';
      document.getElementById('examStartScreen').style.display = 'block';
    }
  </script>
</body>

</html>